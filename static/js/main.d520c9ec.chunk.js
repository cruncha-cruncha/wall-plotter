(this["webpackJsonpwall-plotter"]=this["webpackJsonpwall-plotter"]||[]).push([[0],{29:function(e,t,r){},34:function(e,t,r){},36:function(e,t,r){"use strict";r.r(t);var o=r(2),c=r.n(o),s=r(18),n=r.n(s),i=(r(29),r(6)),a=r(4),l=r(37),u=r(38),h=Object(i.b)({key:"fileContents",default:""});var f=r(0);var p=function(){var e={setFileContent:Object(i.f)(h)}.setFileContent,t=Object(o.useState)(null),r=Object(a.a)(t,2),c=r[0],s=r[1];return Object(f.jsxs)("div",{className:"mb-4",children:[Object(f.jsxs)("div",{className:"mb-3",children:[Object(f.jsx)(l.a,{for:"select-svg-input",children:"Select an SVG"}),Object(f.jsx)(u.a,{type:"file",id:"select-svg-input",accept:".svg",onChange:function(t){var r=URL.createObjectURL(t.target.files[0]);s(r);var o=new FileReader;o.onload=function(){e(o.result)},o.readAsText(t.target.files[0])}})]}),Object(f.jsx)("div",{className:"d-flex",children:Object(f.jsx)("div",{style:{border:"1px solid black",height:"402px",width:"402px",overflow:"scroll"},children:c&&Object(f.jsx)("img",{src:c,width:"400",alt:"selected img"})})})]})},d=r(39),b=r(8),j=r(5),y=Object(i.b)({key:"specs",default:{"step-resolution":"1.8","final-height":"60","spool-radius":"2","eye-to-eye":"150","specify-start-by-coors":!1,"initial-length-left":"42","initial-length-right":"124","initial-coors-x":"30","initial-coors-y":"30","tool-offset-x":"2","tool-offset-y":"1.5","output-resolution":"0.5"}});var x=function(e){var t=e.label,r=e.actionType,o=e.specs,c=e.dispatch;return Object(f.jsxs)("div",{className:"row mb-3",children:[Object(f.jsx)("div",{className:"col-6 d-flex flex-row align-items-center",children:Object(f.jsx)(u.a,{id:r,type:"number",step:"any",value:o[r],onChange:function(e){return c({type:r,payload:e.target.value})}})}),Object(f.jsx)("div",{className:"col-6 d-flex flex-row align-items-center",children:Object(f.jsx)(l.a,{for:r,children:t})})]})},O=function(){var e=function(){var e=Object(i.d)(y),t=Object(a.a)(e,2),r=t[0],o=t[1];return{specs:r,dispatch:function(e){o(Object(j.a)(Object(j.a)({},r),{},Object(b.a)({},e.type,e.payload)))}}}(),t=e.specs,r=e.dispatch;return Object(f.jsxs)("div",{className:"specifications",children:[Object(f.jsx)("h2",{children:"Specifications"}),Object(f.jsx)("p",{children:"All values in cms unless otherwise specified."}),Object(f.jsx)(x,{label:"Step Resolution (degrees)",actionType:"step-resolution",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Output Height",actionType:"final-height",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Output Resolution",actionType:"output-resolution",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Spool Radius",actionType:"spool-radius",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Eye-To-Eye",actionType:"eye-to-eye",specs:t,dispatch:r}),Object(f.jsx)("p",{children:"It's assumed that the plotter uses two strings, each with one end wound around a spool, travelling through an eye, and the other attached to a symmetrical tool holder. The program will start drawing from the upper-left corner of the image."}),Object(f.jsxs)(d.a,{tag:"fieldset",children:[Object(f.jsx)("legend",{children:"Initial Position"}),Object(f.jsx)(d.a,{check:!0,children:Object(f.jsxs)(l.a,{check:!0,children:[Object(f.jsx)(u.a,{type:"radio",onChange:function(){return r({type:"specify-start-by-coors",payload:!1})},checked:!t["specify-start-by-coors"]})," ","Specify by distance from spools"]})}),Object(f.jsx)(d.a,{check:!0,children:Object(f.jsxs)(l.a,{check:!0,children:[Object(f.jsx)(u.a,{type:"radio",onChange:function(){return r({type:"specify-start-by-coors",payload:!0})},checked:t["specify-start-by-coors"]})," ","Specify by horizontal and vertical offset"]})})]}),t["specify-start-by-coors"]?Object(f.jsxs)(o.Fragment,{children:[Object(f.jsx)("p",{children:"Measure from the center of the left spool to the top left corner of the desired image location."}),Object(f.jsx)(x,{label:"Horizontal Offset",actionType:"initial-coors-x",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Vertical Offset",actionType:"initial-coors-y",specs:t,dispatch:r})]}):Object(f.jsxs)(o.Fragment,{children:[Object(f.jsx)("p",{children:"Measure from the center of either the left or right spool to the corresponding tool holder terminus (where the string connects)."}),Object(f.jsx)(x,{label:"Left, initial distance",actionType:"initial-length-left",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Right, initial distance",actionType:"initial-length-right",specs:t,dispatch:r})]}),Object(f.jsx)("p",{children:'The left terminus is assumed to be above and to the left of the tool, while the right terminus is assumed to be above and to the right of the tool. "Horizontal Terminus Offset" is the horizontal distance between a terminus and the tool tip (it should be the same for both termini); "Vertical Terminus Offset" is the vertical distance between a terminus and the tool tip (should also be the same for both).'}),Object(f.jsx)(x,{label:"Horizontal Terminus Offset",actionType:"tool-offset-x",specs:t,dispatch:r}),Object(f.jsx)(x,{label:"Vertical Terminus Offset",actionType:"tool-offset-y",specs:t,dispatch:r})]})},g=r(40),v=r(14),m=r(3),w=r(9),k=r.n(w),N=r(16),L=Object(i.b)({key:"progress",default:[]}),M=Object(i.b)({key:"downloadBload",default:null}),R={"final-height":{upper:1e3,lower:1},"eye-to-eye":{upper:1e3,lower:1},"spool-radius":{upper:25,lower:0},"initial-length-left":{upper:1e3,lower:0},"initial-length-right":{upper:1e3,lower:0},"initial-coors-x":{upper:1e3,lower:0},"initial-coors-y":{upper:1e3,lower:0},"tool-offset-x":{upper:50,lower:0},"tool-offset-y":{upper:50,lower:0}},T=Object(i.c)({key:"coorErrors",get:function(e){var t=e.get,r=t(h),o=t(y);if(!r||!o)return{msg:"No image"};for(var c=Object.keys(o).reduce((function(e,t){return Object(j.a)(Object(j.a)({},e),{},Object(b.a)({},t,Number(o[t])))}),{}),s=0,n=Object.keys(R);s<n.length;s++){var i=n[s];if(!(i in c))return{spec:i,msg:"Missing ".concat(i," specification")}}for(var a=0,l=Object.keys(R);a<l.length;a++){var u=l[a];if(c[u]>R[u].upper)return{spec:u,msg:"".concat(u," is too high; max is ").concat(R[u].upper)};if(c[u]<R[u].lower)return{spec:u,msg:"".concat(u," is too low; minimum is ").concat(R[u].lower)}}return c["specify-start-by-coors"]&&c["initial-coors-x"]+2*c["tool-offset-x"]>c["eye-to-eye"]?{msg:"Specs are not physically valid"}:null}}),S=Object(i.c)({key:"coorsReady",get:function(e){return!(0,e.get)(T)}});function E(e){var t=e.eyeToEye,r=e.toolOffsetX,o=e.toolOffsetY,c=e.leftLength,s=e.rightLength;if(t<=0||r<0||o<0||c<0||s<0)return null;var n=t-2*r,i=Math.pow(s,2)-Math.pow(c,2)-Math.pow(n,2),a=4*Math.pow(n,2),l=-4*Math.pow(n,2)*Math.pow(c,2)+Math.pow(i,2),u=Math.sqrt(-4*a*l)/(2*a);return{x:Math.sqrt(Math.pow(c,2)-Math.pow(u,2))+r,y:u+o}}var C=Object(i.c)({key:"realCoors",get:function(e){var t=e.get,r=t(S),o=t(y),c=t(h);if(!r)return null;var s=Object.keys(o).reduce((function(e,t){return Object(j.a)(Object(j.a)({},e),{},Object(b.a)({},t,Number(o[t])))}),{}),n=function(e){return e/10},i=(new DOMParser).parseFromString(c,"application/xml"),l=Array.from(i.querySelectorAll("svg"))[0];if(l.getAttribute("viewBox")){var u=l.getAttribute("viewBox").split(" "),f=Object(a.a)(u,4),p=(f[0],f[1],f[2]),d=f[3],x=function(e){return e*(10*s["final-height"])/d};if(s["specify-start-by-coors"])return{spoolRadius:s["spool-radius"],leftEye:{x:0,y:0},rightEye:{x:s["eye-to-eye"],y:0},leftLine:{start:{x:0,y:0},end:{x:s["initial-coors-x"]-s["tool-offset-x"],y:s["initial-coors-y"]-s["tool-offset-y"]}},rightLine:{start:{x:s["eye-to-eye"],y:0},end:{x:s["initial-coors-x"]+s["tool-offset-x"],y:s["initial-coors-y"]-s["tool-offset-y"]}},outputRect:{x:s["initial-coors-x"],y:s["initial-coors-y"],width:n(x(p)),height:n(x(d))},totalWidth:s["eye-to-eye"],totalHeight:s["initial-coors-y"]+n(x(d))};var O=E({eyeToEye:s["eye-to-eye"],toolOffsetX:s["tool-offset-x"],toolOffsetY:s["tool-offset-y"],leftLength:s["initial-length-left"],rightLength:s["initial-length-right"]});if(!O)return null;if(isNaN(O.x)||isNaN(O.y))return null;var g=O.y-s["tool-offset-y"],v=g,m=O.x-s["tool-offset-x"],w=O.x+s["tool-offset-x"];return{spoolRadius:s["spool-radius"],leftEye:{x:0,y:0},rightEye:{x:s["eye-to-eye"],y:0},leftLine:{start:{x:0,y:0},end:{x:m,y:g}},rightLine:{start:{x:s["eye-to-eye"],y:0},end:{x:w,y:v}},outputRect:{x:m+s["tool-offset-x"],y:g+s["tool-offset-y"],width:n(x(p)),height:n(x(d))},totalWidth:s["eye-to-eye"],totalHeight:g+s["tool-offset-y"]+n(x(d))}}alert("SVG needs a viewBox")}}),F={"step-resolution":{upper:45,lower:.01},"output-resolution":{upper:10,lower:.1}},A=Object(i.c)({key:"specErrors",get:function(e){var t=e.get,r=t(C),o=t(y);if(!r)return{msg:"Specs are not physically valid"};if(r.outputRect.x+r.outputRect.width>r.rightEye.x)return{msg:"Can't draw outside vertical bounds of eyes"};for(var c=Object.keys(o).reduce((function(e,t){return Object(j.a)(Object(j.a)({},e),{},Object(b.a)({},t,Number(o[t])))}),{}),s=0,n=Object.keys(F);s<n.length;s++){var i=n[s];if(!(i in c))return{spec:i,msg:"Missing ".concat(i," specification")}}for(var a=0,l=Object.keys(F);a<l.length;a++){var u=l[a];if(c[u]>F[u].upper)return{spec:u,msg:"".concat(u," is too high; max is ").concat(F[u].upper)};if(c[u]<F[u].lower)return{spec:u,msg:"".concat(u," is too low; minimum is ").concat(F[u].lower)}}return null}}),D=Object(i.c)({key:"specsReady",get:function(e){return!(0,e.get)(A)}});var P=function(){var e=function(){var e=Object(i.f)(L),t=Object(i.e)(y),r=Object(i.e)(h),c=Object(i.e)(D),s=Object(i.e)(A),n=Object(i.e)(T),l=Object(i.e)(C),u=Object(i.d)(M),f=Object(a.a)(u,2),p=f[0],d=f[1],x=Object(o.useState)(""),O=Object(a.a)(x,2),g=O[0],w=O[1],R=function(e){return 10*e},S=function(){var o=Object(N.a)(k.a.mark((function o(){var s,n,i,u,h,f,p,y,x,O,g,w,L,M,T,S,C,F,A,D,P,B,H,q,z,I,V,W,U,J,X,Y,G,K,Q;return k.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!c){o.next=73;break}return s=Object.keys(t).reduce((function(e,r){return Object(j.a)(Object(j.a)({},e),{},Object(b.a)({},r,Number(t[r])))}),{}),e([]),n=[],i=function(){var t=Object(N.a)(k.a.mark((function t(r){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.push(r),e([].concat(n)),t.next=4,new Promise((function(e){return setTimeout(e,0)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),u=new DOMParser,h=u.parseFromString(r,"application/xml"),f=h.querySelector("svg"),p=f.getAttribute("viewBox").split(" "),(y=Object(a.a)(p,4))[0],y[1],y[2],x=y[3],O=Array.from(h.querySelectorAll("path")),o.next=12,i("Found ".concat(O.length," paths, of lengths:"));case 12:g=0;case 13:if(!(g<O.length)){o.next=19;break}return o.next=16,i("".concat(g,": ").concat(Math.round(100*O[g].getTotalLength())/100));case 16:g++,o.next=13;break;case 19:w=function(e){return e*R(s["final-height"])/x},L=function(e){return e*x/R(s["final-height"])},M=function(e){return{x:R(l.outputRect.x)+w(e.x),y:R(l.outputRect.y)+w(e.y)}},T=function(e){for(var t=[],r=w(e.getTotalLength()),o=0;o<r;)t.push(M(e.getPointAtLength(L(o)))),o+=R(s["output-resolution"]);return t},S=function(e){var t=e.actualLeftSteps,r=e.leftDirection,o=e.actualRightSteps,c=e.rightDirection,s=Math.max(t,o),n=0===t?0:s/t,i=0===o?0:s/o,a=new Array(s).fill(null).map((function(){return{l:0,r:0}}));if(n>0&&i>0)for(var l=0,u=0,h=0;h<s;h++)h>=l&&(a[h].l=r,l+=n),h>=u&&(a[h].r=c,u+=i);else if(i<=0)for(var f=0,p=0;p<s;p++)p>=f&&(a[p].l=r,f+=n);else if(n<=0)for(var d=0,b=0;b<s;b++)b>=d&&(a[b].r=c,d+=i);return a},C=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},F=R(2*Math.PI*s["spool-radius"]*s["step-resolution"]/360),A=1/F,D=function(e,t){var r=C({x:0,y:0},t)-C({x:0,y:0},e),o=C({x:R(s["eye-to-eye"]),y:0},t)-C({x:R(s["eye-to-eye"]),y:0},e),c=Math.round(Math.abs(r)*A),n=Math.round(Math.abs(o)*A),i=0===c?0:r/Math.abs(r),a=0===n?0:-1*o/Math.abs(o),l=C({x:0,y:0},e)+c*F*i,u=C({x:R(s["eye-to-eye"]),y:0},e)+n*F*a*-1;return{pulses:S({actualLeftSteps:c,leftDirection:i,actualRightSteps:n,rightDirection:a}),newCurrent:E({eyeToEye:R(s["eye-to-eye"]),toolOffsetX:R(s["tool-offset-x"]),toolOffsetY:R(s["tool-offset-y"]),leftLength:l,rightLength:u})}},(P={}).start={x:R(l.outputRect.x),y:R(l.outputRect.y)},H=0;case 31:if(!(H<O.length)){o.next=41;break}return B=Date.now(),q="path-".concat(H),P[q]=T(O[H]),z=Date.now(),o.next=38,i("path ".concat(H," converted to coors (").concat(z-B," ms)"));case 38:H++,o.next=31;break;case 41:I=[],V=P.start,W=0;case 44:if(!(W<O.length)){o.next=72;break}B=Date.now(),U=Object(m.a)(P["path-".concat(W)]),o.prev=47,U.s();case 49:if((J=U.n()).done){o.next=58;break}if(X=J.value,Y=D(V,X),G=Y.newCurrent,K=Y.pulses,G){o.next=54;break}return o.abrupt("return",null);case 54:V=G,I=[].concat(Object(v.a)(I),Object(v.a)(K));case 56:o.next=49;break;case 58:o.next=63;break;case 60:o.prev=60,o.t0=o.catch(47),U.e(o.t0);case 63:return o.prev=63,U.f(),o.finish(63);case 66:return Q=Date.now(),o.next=69,i("path ".concat(W," converted to pulses (").concat(Q-B," ms)"));case 69:W++,o.next=44;break;case 72:d(new Blob([JSON.stringify(I)],{type:"text/plain"}));case 73:case"end":return o.stop()}}),o,null,[[47,60,63,66]])})));return function(){return o.apply(this,arguments)}}();return Object(o.useEffect)((function(){p&&w(URL.createObjectURL(p))}),[p]),{specErrors:s,coorErrors:n,ready:c,go:S,downloadHref:g}}(),t=e.specErrors,r=e.coorErrors,c=e.ready,s=e.go,n=e.downloadHref;return Object(f.jsxs)("div",{className:"row",children:[Object(f.jsx)("div",{className:"col-12",children:Object(f.jsx)("div",{className:"my-2",children:r?Object(f.jsx)("span",{className:"text-danger",children:r.msg}):t?Object(f.jsx)("span",{className:"text-danger",children:t.msg}):null})}),Object(f.jsx)("div",{className:"col-12",children:Object(f.jsx)(g.a,{disabled:!c,onClick:s,children:"Calc motor control"})}),Object(f.jsx)("div",{className:"col-12 my-3",children:""!==n&&Object(f.jsx)("a",{href:n,download:"motorControl.json",children:"download"})})]})};var B=function(){var e=function(){var e=Object(i.e)(C),t=Object(o.useState)(null),r=Object(a.a)(t,2),c=r[0],s=r[1];return Object(o.useEffect)((function(){if(e){var t=Object(f.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"400",viewBox:"-".concat(20," -").concat(20," ").concat(e.totalWidth+40," ").concat(e.totalHeight+40),children:[Object(f.jsx)("line",{x1:e.leftLine.start.x,y1:e.leftLine.start.y,x2:e.leftLine.end.x,y2:e.leftLine.end.y,style:{stroke:"black",strokeWidth:1}}),Object(f.jsx)("line",{x1:e.rightLine.start.x,y1:e.rightLine.start.y,x2:e.rightLine.end.x,y2:e.rightLine.end.y,style:{stroke:"black",strokeWidth:1}}),Object(f.jsx)("rect",{x:e.outputRect.x,y:e.outputRect.y,width:e.outputRect.width,height:e.outputRect.height,style:{fill:"blue"}}),Object(f.jsx)("circle",{cx:e.leftEye.x,cy:e.leftEye.y,r:e.spoolRadius,fill:"black"}),Object(f.jsx)("circle",{cx:e.rightEye.x,cy:e.rightEye.y,r:e.spoolRadius,fill:"black"})]});s(t)}else s(null)}),[e]),{svg:c}}().svg;return Object(f.jsxs)("div",{className:"mb-4",children:[Object(f.jsx)("div",{className:"mb-2",children:Object(f.jsx)("span",{children:"Preview"})}),Object(f.jsx)("div",{className:"d-flex",children:Object(f.jsx)("div",{style:{border:"1px solid black",height:"402px",width:"402px",overflow:"scroll"},children:e})})]})};var H=function(){var e={progress:Object(i.e)(L)}.progress;return Object(f.jsxs)("div",{children:[Object(f.jsx)("div",{className:"mb-2",children:Object(f.jsx)("span",{children:"Progress"})}),Object(f.jsx)("div",{className:"d-flex",children:Object(f.jsx)("div",{style:{border:"1px solid black",height:"402px",width:"402px",overflow:"scroll",padding:"10px"},children:e.map((function(e){return Object(f.jsx)("div",{children:Object(f.jsxs)("span",{children:["> ",e]})},e)}))})})]})};r(34);var q=function(){return Object(f.jsx)(i.a,{children:Object(f.jsx)("div",{className:"container my-5",children:Object(f.jsxs)("div",{className:"row",children:[Object(f.jsxs)("div",{className:"col-lg-6",children:[Object(f.jsx)(p,{}),Object(f.jsx)(B,{}),Object(f.jsx)(H,{})]}),Object(f.jsxs)("div",{className:"col-lg-6",children:[Object(f.jsx)(O,{}),Object(f.jsx)(P,{})]})]})})})},z=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,41)).then((function(t){var r=t.getCLS,o=t.getFID,c=t.getFCP,s=t.getLCP,n=t.getTTFB;r(e),o(e),c(e),s(e),n(e)}))};r(35);n.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(q,{})}),document.getElementById("root")),z()}},[[36,1,2]]]);
//# sourceMappingURL=main.d520c9ec.chunk.js.map