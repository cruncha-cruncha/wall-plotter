(this["webpackJsonpwall-plotter"]=this["webpackJsonpwall-plotter"]||[]).push([[0],{29:function(e,t,r){},34:function(e,t,r){},36:function(e,t,r){"use strict";r.r(t);var o=r(2),c=r.n(o),s=r(18),n=r.n(s),i=(r(29),r(6)),a=r(4),l=r(37),u=r(38),f=Object(i.b)({key:"fileContents",default:""});var h=r(0);var p=function(){var e={setFileContent:Object(i.f)(f)}.setFileContent,t=Object(o.useState)(null),r=Object(a.a)(t,2),c=r[0],s=r[1];return Object(h.jsxs)("div",{className:"mb-4",children:[Object(h.jsxs)("div",{className:"mb-3",children:[Object(h.jsx)(l.a,{for:"select-svg-input",children:"Select an SVG"}),Object(h.jsx)(u.a,{type:"file",id:"select-svg-input",accept:".svg",onChange:function(t){var r=URL.createObjectURL(t.target.files[0]);s(r);var o=new FileReader;o.onload=function(){e(o.result)},o.readAsText(t.target.files[0])}})]}),Object(h.jsx)("div",{className:"d-flex",children:Object(h.jsx)("div",{style:{border:"1px solid black",height:"402px",minWidth:"402px",overflowY:"scroll"},children:c&&Object(h.jsx)("img",{src:c,width:"400",alt:"selected img"})})})]})},d=r(39),b=r(8),y=r(5),j=Object(i.b)({key:"specs",default:{"step-resolution":"0.225","final-height":"20","spool-radius":"2","eye-to-eye":"101","specify-start-by-coors":!0,"initial-length-left":"42","initial-length-right":"124","initial-coors-x":"42","initial-coors-y":"58","tool-offset-x":"3","tool-offset-y":"2"}});var x=function(e){var t=e.label,r=e.actionType,o=e.specs,c=e.dispatch;return Object(h.jsxs)("div",{className:"row mb-3",children:[Object(h.jsx)("div",{className:"col-6 d-flex flex-row align-items-center",children:Object(h.jsx)(u.a,{id:r,type:"number",step:"any",value:o[r],onChange:function(e){return c({type:r,payload:e.target.value})}})}),Object(h.jsx)("div",{className:"col-6 d-flex flex-row align-items-center",children:Object(h.jsx)(l.a,{for:r,children:t})})]})},g=function(){var e=function(){var e=Object(i.d)(j),t=Object(a.a)(e,2),r=t[0],o=t[1];return{specs:r,dispatch:function(e){o(Object(y.a)(Object(y.a)({},r),{},Object(b.a)({},e.type,e.payload)))}}}(),t=e.specs,r=e.dispatch;return Object(h.jsxs)("div",{className:"specifications",children:[Object(h.jsx)("h2",{children:"Specifications"}),Object(h.jsx)("p",{children:"All values in cms unless otherwise specified."}),Object(h.jsx)(x,{label:"Step Resolution (degrees)",actionType:"step-resolution",specs:t,dispatch:r}),Object(h.jsx)(x,{label:"Output Height",actionType:"final-height",specs:t,dispatch:r}),Object(h.jsx)(x,{label:"Spool Radius",actionType:"spool-radius",specs:t,dispatch:r}),Object(h.jsx)(x,{label:"Eye-To-Eye",actionType:"eye-to-eye",specs:t,dispatch:r}),Object(h.jsx)("p",{children:"It's assumed that the plotter uses two strings, each with one end wound around a spool, travelling through an eye, and the other attached to a symmetrical tool holder. The program will start drawing from the upper-left corner of the image."}),Object(h.jsxs)(d.a,{tag:"fieldset",children:[Object(h.jsx)("legend",{children:"Initial Position"}),Object(h.jsx)(d.a,{check:!0,children:Object(h.jsxs)(l.a,{check:!0,children:[Object(h.jsx)(u.a,{type:"radio",onChange:function(){return r({type:"specify-start-by-coors",payload:!1})},checked:!t["specify-start-by-coors"]})," ","Specify by distance from eyes"]})}),Object(h.jsx)(d.a,{check:!0,children:Object(h.jsxs)(l.a,{check:!0,children:[Object(h.jsx)(u.a,{type:"radio",onChange:function(){return r({type:"specify-start-by-coors",payload:!0})},checked:t["specify-start-by-coors"]})," ","Specify by horizontal and vertical offset"]})})]}),t["specify-start-by-coors"]?Object(h.jsxs)(o.Fragment,{children:[Object(h.jsx)("p",{children:"Measure from the center of the left eye to the top left corner of the desired image location."}),Object(h.jsx)(x,{label:"Horizontal Offset",actionType:"initial-coors-x",specs:t,dispatch:r}),Object(h.jsx)(x,{label:"Vertical Offset",actionType:"initial-coors-y",specs:t,dispatch:r})]}):Object(h.jsxs)(o.Fragment,{children:[Object(h.jsx)("p",{children:"Measure from either the left or right eye to the corresponding tool holder terminus (where the string connects)."}),Object(h.jsx)(x,{label:"Left, initial distance",actionType:"initial-length-left",specs:t,dispatch:r}),Object(h.jsx)(x,{label:"Right, initial distance",actionType:"initial-length-right",specs:t,dispatch:r})]}),Object(h.jsx)("p",{children:'The left terminus is assumed to be above and to the left of the tool, while the right terminus is assumed to be above and to the right of the tool. "Horizontal Terminus Offset" is the horizontal distance between a terminus and the tool tip (it should be the same for both termini); "Vertical Terminus Offset" is the vertical distance between a terminus and the tool tip (should also be the same for both).'}),Object(h.jsx)(x,{label:"Horizontal Terminus Offset",actionType:"tool-offset-x",specs:t,dispatch:r}),Object(h.jsx)(x,{label:"Vertical Terminus Offset",actionType:"tool-offset-y",specs:t,dispatch:r})]})},O=r(40),m=r(14),v=r(3),w=r(9),k=r.n(w),M=r(16),L=Object(i.b)({key:"progress",default:[]}),N=Object(i.b)({key:"downloadBload",default:null}),R={"final-height":{upper:1e3,lower:1},"eye-to-eye":{upper:1e3,lower:1},"spool-radius":{upper:25,lower:0},"initial-length-left":{upper:1e3,lower:0},"initial-length-right":{upper:1e3,lower:0},"initial-coors-x":{upper:1e3,lower:0},"initial-coors-y":{upper:1e3,lower:0},"tool-offset-x":{upper:50,lower:0},"tool-offset-y":{upper:50,lower:0}},T=Object(i.c)({key:"coorErrors",get:function(e){var t=e.get,r=t(f),o=t(j);if(!r||!o)return{msg:"No image"};for(var c=Object.keys(o).reduce((function(e,t){return Object(y.a)(Object(y.a)({},e),{},Object(b.a)({},t,Number(o[t])))}),{}),s=0,n=Object.keys(R);s<n.length;s++){var i=n[s];if(!(i in c))return{spec:i,msg:"Missing ".concat(i," specification")}}for(var a=0,l=Object.keys(R);a<l.length;a++){var u=l[a];if(c[u]>R[u].upper)return{spec:u,msg:"".concat(u," is too high; max is ").concat(R[u].upper)};if(c[u]<R[u].lower)return{spec:u,msg:"".concat(u," is too low; minimum is ").concat(R[u].lower)}}return c["specify-start-by-coors"]&&c["initial-coors-x"]+2*c["tool-offset-x"]>c["eye-to-eye"]?{msg:"Specs are not physically valid"}:null}}),S=Object(i.c)({key:"coorsReady",get:function(e){return!(0,e.get)(T)}});function E(e){var t=e.eyeToEye,r=e.toolOffsetX,o=e.toolOffsetY,c=e.leftLength,s=e.rightLength;if(t<=0||r<0||o<0||c<0||s<0)return null;var n=t-2*r,i=Math.pow(s,2)-Math.pow(c,2)-Math.pow(n,2),a=4*Math.pow(n,2),l=-4*Math.pow(n,2)*Math.pow(c,2)+Math.pow(i,2),u=Math.sqrt(-4*a*l)/(2*a);return{x:Math.sqrt(Math.pow(c,2)-Math.pow(u,2))+r,y:u+o}}var C=Object(i.c)({key:"realCoors",get:function(e){var t=e.get,r=t(S),o=t(j),c=t(f);if(!r)return null;var s=Object.keys(o).reduce((function(e,t){return Object(y.a)(Object(y.a)({},e),{},Object(b.a)({},t,Number(o[t])))}),{}),n=function(e){return e/10},i=(new DOMParser).parseFromString(c,"application/xml"),l=Array.from(i.querySelectorAll("svg"))[0];if(l.getAttribute("viewBox")){var u=D(l.getAttribute("viewBox")),h=Object(a.a)(u,4),p=(h[0],h[1],h[2]),d=h[3],x=function(e){return e*(10*s["final-height"])/d};if(s["specify-start-by-coors"])return{spoolRadius:s["spool-radius"],leftEye:{x:0,y:0},rightEye:{x:s["eye-to-eye"],y:0},leftLine:{start:{x:0,y:0},end:{x:s["initial-coors-x"]-s["tool-offset-x"],y:s["initial-coors-y"]-s["tool-offset-y"]}},rightLine:{start:{x:s["eye-to-eye"],y:0},end:{x:s["initial-coors-x"]+s["tool-offset-x"],y:s["initial-coors-y"]-s["tool-offset-y"]}},outputRect:{x:s["initial-coors-x"],y:s["initial-coors-y"],width:n(x(p)),height:n(x(d))},totalWidth:s["eye-to-eye"],totalHeight:s["initial-coors-y"]+n(x(d))};var g=E({eyeToEye:s["eye-to-eye"],toolOffsetX:s["tool-offset-x"],toolOffsetY:s["tool-offset-y"],leftLength:s["initial-length-left"],rightLength:s["initial-length-right"]});if(!g)return null;if(isNaN(g.x)||isNaN(g.y))return null;var O=g.y-s["tool-offset-y"],m=O,v=g.x-s["tool-offset-x"],w=g.x+s["tool-offset-x"];return{spoolRadius:s["spool-radius"],leftEye:{x:0,y:0},rightEye:{x:s["eye-to-eye"],y:0},leftLine:{start:{x:0,y:0},end:{x:v,y:O}},rightLine:{start:{x:s["eye-to-eye"],y:0},end:{x:w,y:m}},outputRect:{x:v+s["tool-offset-x"],y:O+s["tool-offset-y"],width:n(x(p)),height:n(x(d))},totalWidth:s["eye-to-eye"],totalHeight:O+s["tool-offset-y"]+n(x(d))}}alert("SVG needs a viewBox")}}),P={"step-resolution":{upper:45,lower:.01}},A=Object(i.c)({key:"specErrors",get:function(e){var t=e.get,r=t(C),o=t(j);if(!r)return{msg:"Specs are not physically valid"};if(r.outputRect.x+r.outputRect.width>r.rightEye.x)return{msg:"Can't draw outside vertical bounds of eyes"};for(var c=Object.keys(o).reduce((function(e,t){return Object(y.a)(Object(y.a)({},e),{},Object(b.a)({},t,Number(o[t])))}),{}),s=0,n=Object.keys(P);s<n.length;s++){var i=n[s];if(!(i in c))return{spec:i,msg:"Missing ".concat(i," specification")}}for(var a=0,l=Object.keys(P);a<l.length;a++){var u=l[a];if(c[u]>P[u].upper)return{spec:u,msg:"".concat(u," is too high; max is ").concat(P[u].upper)};if(c[u]<P[u].lower)return{spec:u,msg:"".concat(u," is too low; minimum is ").concat(P[u].lower)}}return null}}),F=Object(i.c)({key:"specsReady",get:function(e){return!(0,e.get)(A)}}),D=function(e){return e.split(e.includes(",")?",":" ").map((function(e){return Number(e.trim())}))};var B=function(){var e=function(){var e=Object(i.f)(L),t=Object(i.e)(j),r=Object(i.e)(f),c=Object(i.e)(F),s=Object(i.e)(A),n=Object(i.e)(T),l=Object(i.e)(C),u=Object(i.d)(N),h=Object(a.a)(u,2),p=h[0],d=h[1],x=Object(o.useState)(""),g=Object(a.a)(x,2),O=g[0],w=g[1],R=function(e){return 10*e},S=function(){var o=Object(M.a)(k.a.mark((function o(){var s,n,i,u,f,h,p,j,x,g,O,w,L,N,T,S,C,P,A,F,B,H,q,W,I,Y,z,V,U,J,X,G,K,Q,Z,$,_;return k.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!c){o.next=76;break}return s=Object.keys(t).reduce((function(e,r){return Object(y.a)(Object(y.a)({},e),{},Object(b.a)({},r,Number(t[r])))}),{}),e([]),n=[],i=function(){var t=Object(M.a)(k.a.mark((function t(r){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.push(r),e([].concat(n)),t.next=4,new Promise((function(e){return setTimeout(e,0)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),u=new DOMParser,f=u.parseFromString(r,"application/xml"),h=f.querySelector("svg"),p=D(h.getAttribute("viewBox")),(j=Object(a.a)(p,4))[0],j[1],j[2],x=j[3],g=Array.from(f.querySelectorAll("path")),o.next=12,i("Found ".concat(g.length," paths, of lengths:"));case 12:O=0;case 13:if(!(O<g.length)){o.next=19;break}return o.next=16,i("".concat(O,": ").concat(Math.round(100*g[O].getTotalLength())/100));case 16:O++,o.next=13;break;case 19:w=function(e){return e*R(s["final-height"])/x},L=function(e){return e*x/R(s["final-height"])},N=function(e){return{x:R(l.outputRect.x)+w(e.x),y:R(l.outputRect.y)+w(e.y)}},T=function(e,t,r){return Math.abs((r.x-e.x)*(e.y-t.y)-(e.x-t.x)*(r.y-e.y))/Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))},S=function(e){var t=[],r=w(e.getTotalLength());if(t.push(N(e.getPointAtLength(0))),r>2&&(t.push(N(e.getPointAtLength(L(2)))),r>4))for(var o=0,c=4,s=2;c<r;){var n=N(e.getPointAtLength(L(c)));T(t[o],t[o+1],n)<s?(t[o+1]=n,s/=2):(o+=1,t.push(n),s=2),c+=2}return t.push(N(e.getPointAtLength(e.getTotalLength()))),t},C=function(e){var t=e.actualLeftSteps,r=e.leftDirection,o=e.actualRightSteps,c=e.rightDirection,s=Math.max(t,o),n=0===t?0:s/t,i=0===o?0:s/o,a=new Array(s).fill(null).map((function(){return{l:0,r:0}}));if(n>0&&i>0)for(var l=0,u=0,f=0;f<s;f++)f>=l&&(a[f].l=r,l+=n),f>=u&&(a[f].r=c,u+=i);else if(i<=0)for(var h=0,p=0;p<s;p++)p>=h&&(a[p].l=r,h+=n);else if(n<=0)for(var d=0,b=0;b<s;b++)b>=d&&(a[b].r=c,d+=i);return a},P=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},A=R(2*Math.PI*s["spool-radius"]*s["step-resolution"]/360),F=1/A,B=function(e,t){var r={x:e.x-R(s["tool-offset-x"]),y:e.y-R(s["tool-offset-y"])},o={x:t.x-R(s["tool-offset-x"]),y:t.y-R(s["tool-offset-y"])},c={x:e.x+R(s["tool-offset-x"]),y:e.y-R(s["tool-offset-y"])},n={x:t.x+R(s["tool-offset-x"]),y:t.y-R(s["tool-offset-y"])},i=P({x:0,y:0},o)-P({x:0,y:0},r),a=P({x:R(s["eye-to-eye"]),y:0},n)-P({x:R(s["eye-to-eye"]),y:0},c),l=Math.round(Math.abs(i)*F),u=Math.round(Math.abs(a)*F),f=0===l?0:i/Math.abs(i),h=0===u?0:a/Math.abs(a),p=P({x:0,y:0},r)+l*A*f,d=P({x:R(s["eye-to-eye"]),y:0},c)+u*A*h;return{pulses:C({actualLeftSteps:l,leftDirection:f,actualRightSteps:u,rightDirection:h}),newCurrent:E({eyeToEye:R(s["eye-to-eye"]),toolOffsetX:R(s["tool-offset-x"]),toolOffsetY:R(s["tool-offset-y"]),leftLength:p,rightLength:d})}},(H={}).start={x:R(l.outputRect.x),y:R(l.outputRect.y)},W=0;case 32:if(!(W<g.length)){o.next=42;break}return q=Date.now(),I="path-".concat(W),H[I]=S(g[W]),Y=Date.now(),o.next=39,i("path ".concat(W," converted to coors (").concat(Y-q," ms)"));case 39:W++,o.next=32;break;case 42:z=[],V=H.start,U=0;case 45:if(!(U<g.length)){o.next=73;break}q=Date.now(),J=Object(v.a)(H["path-".concat(U)]),o.prev=48,J.s();case 50:if((X=J.n()).done){o.next=59;break}if(G=X.value,K=B(V,G),Q=K.newCurrent,Z=K.pulses,Q){o.next=55;break}return o.abrupt("return",null);case 55:V=Q,z=[].concat(Object(m.a)(z),Object(m.a)(Z));case 57:o.next=50;break;case 59:o.next=64;break;case 61:o.prev=61,o.t0=o.catch(48),J.e(o.t0);case 64:return o.prev=64,J.f(),o.finish(64);case 67:return $=Date.now(),o.next=70,i("path ".concat(U," converted to pulses (").concat($-q," ms)"));case 70:U++,o.next=45;break;case 73:_={stepsPerSecond:2/(s["step-resolution"]/360*s["spool-radius"]*2*Math.PI),pulses:z},d(new Blob([JSON.stringify(_)],{type:"text/plain"}));case 76:case"end":return o.stop()}}),o,null,[[48,61,64,67]])})));return function(){return o.apply(this,arguments)}}();return Object(o.useEffect)((function(){p&&w(URL.createObjectURL(p))}),[p]),{specErrors:s,coorErrors:n,ready:c,go:S,downloadHref:O}}(),t=e.specErrors,r=e.coorErrors,c=e.ready,s=e.go,n=e.downloadHref;return Object(h.jsxs)("div",{className:"row",children:[Object(h.jsx)("div",{className:"col-12",children:Object(h.jsx)("div",{className:"my-2",children:r?Object(h.jsx)("span",{className:"text-danger",children:r.msg}):t?Object(h.jsx)("span",{className:"text-danger",children:t.msg}):null})}),Object(h.jsx)("div",{className:"col-12",children:Object(h.jsx)(O.a,{disabled:!c,onClick:s,children:"Calc motor control"})}),Object(h.jsx)("div",{className:"col-12 my-3",children:""!==n&&Object(h.jsx)("a",{href:n,download:"motorControl.json",children:"download"})})]})};var H=function(){var e=function(){var e=Object(i.e)(C),t=Object(o.useState)(null),r=Object(a.a)(t,2),c=r[0],s=r[1];return Object(o.useEffect)((function(){if(e){var t=Object(h.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"400",viewBox:"-".concat(20," -").concat(20," ").concat(e.totalWidth+40," ").concat(e.totalHeight+40),children:[Object(h.jsx)("line",{x1:e.leftLine.start.x,y1:e.leftLine.start.y,x2:e.leftLine.end.x,y2:e.leftLine.end.y,style:{stroke:"black",strokeWidth:1}}),Object(h.jsx)("line",{x1:e.rightLine.start.x,y1:e.rightLine.start.y,x2:e.rightLine.end.x,y2:e.rightLine.end.y,style:{stroke:"black",strokeWidth:1}}),Object(h.jsx)("rect",{x:e.outputRect.x,y:e.outputRect.y,width:e.outputRect.width,height:e.outputRect.height,style:{fill:"blue"}}),Object(h.jsx)("circle",{cx:e.leftEye.x,cy:e.leftEye.y,r:e.spoolRadius,fill:"black"}),Object(h.jsx)("circle",{cx:e.rightEye.x,cy:e.rightEye.y,r:e.spoolRadius,fill:"black"})]});s(t)}else s(null)}),[e]),{svg:c}}().svg;return Object(h.jsxs)("div",{className:"mb-4",children:[Object(h.jsx)("div",{className:"mb-2",children:Object(h.jsx)("span",{children:"Preview"})}),Object(h.jsx)("div",{className:"d-flex",children:Object(h.jsx)("div",{style:{border:"1px solid black",height:"402px",minWidth:"402px",overflowY:"scroll"},children:e})})]})};var q=function(){var e={progress:Object(i.e)(L)}.progress;return Object(h.jsxs)("div",{children:[Object(h.jsx)("div",{className:"mb-2",children:Object(h.jsx)("span",{children:"Progress"})}),Object(h.jsx)("div",{className:"d-flex",children:Object(h.jsx)("div",{style:{border:"1px solid black",height:"402px",width:"402px",overflowY:"scroll",padding:"10px"},children:e.map((function(e){return Object(h.jsx)("div",{children:Object(h.jsxs)("span",{children:["> ",e]})},e)}))})})]})};r(34);var W=function(){return Object(h.jsx)(i.a,{children:Object(h.jsx)("div",{className:"container my-5",children:Object(h.jsxs)("div",{className:"row",children:[Object(h.jsxs)("div",{className:"col-lg-6",children:[Object(h.jsx)(p,{}),Object(h.jsx)(H,{}),Object(h.jsx)(q,{})]}),Object(h.jsxs)("div",{className:"col-lg-6",children:[Object(h.jsx)(g,{}),Object(h.jsx)(B,{})]})]})})})},I=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,41)).then((function(t){var r=t.getCLS,o=t.getFID,c=t.getFCP,s=t.getLCP,n=t.getTTFB;r(e),o(e),c(e),s(e),n(e)}))};r(35);n.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(W,{})}),document.getElementById("root")),I()}},[[36,1,2]]]);
//# sourceMappingURL=main.e7a953d2.chunk.js.map